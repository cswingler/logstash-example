input {
  # This is the main Beats input:
  beats {
    port => 10200
  }

  # Accept Filebeat/TLS on port 5000 
  beats {
    port => 5000
    codec => json
    ssl => true
    ssl_certificate => "/usr/share/logstash/pki/lumberjack.cert"
    ssl_key => "/usr/share/logstash/pki/lumberjack.key"
  }
}

filter {}

output {
  # Send everything we get over to the pipeline_fb instance.
  lumberjack {
    codec => json
    hosts => "logstash-fb"
    ssl_certificate => "/usr/share/logstash/pki/lumberjack.cert"
    port => 5000
  }

  # Kubernetes filebeat forwarder has its own completely different message fields,
  # which means we have to pick completely different attributes off of it in order to
  # make reasonable-looking logs
  # Luckily, we can also identify kubernetes messages by the "kubernetes" top-level attribute
  file { 
    path => "/data/raw.log"
    codec => "json_lines"
  }

  # And again, to the syslog/tcp one:
  syslog {
    host => "logstash-syslog-tcp"
    port => 1514
    protocol => tcp
  }

  # And for good measure, syslog/udp:
  syslog { 
    host => "logstash-syslog-udp"
    port => 1514
    protocol => udp
  }


}
